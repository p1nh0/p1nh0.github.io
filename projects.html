<!-- projects.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Basic meta tags -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Page title -->
  <title>Projects</title>

  <!-- Link to shared CSS stylesheet -->
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

  <!-- Placeholder for dynamically loaded menu -->
  <div id="menu-placeholder"></div>

  <section class="projects">

    <h1>Projects</h1>

    <!-- Introductory paragraph -->
    <p>
      Browse through my projects spanning audio electronics, programming, installations, musical instruments, and more.
      The projects are arranged by date, newest first.
    </p>

    <!-- Container for project previews -->
    <div id="project-list" class="project-list">
      <!-- Projects will be dynamically loaded here -->
    </div>

  </section>

  <!-- JavaScript to load menu dynamically and project previews -->
  <script>
    // Load the shared menu
    fetch('menu.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('menu-placeholder').innerHTML = data;
      })
      .catch(err => console.error('Failed to load menu:', err));

    // List of project pages to fetch previews from (example)
    const projects = [
      //'projects/_example-project.html',
      'projects/augmut.html', 
      'projects/nkisi.html',
      // Add other project page URLs here
    ];

    const projectListEl = document.getElementById('project-list');

    // Function to extract preview info from a project HTML page
    async function fetchProjectPreview(url) {
      try {
        const response = await fetch(url);
        const text = await response.text();

        // Create a DOM parser to parse the project page HTML
        const parser = new DOMParser();
        const doc = parser.parseFromString(text, 'text/html');

        // Extract title, description, and an image (assumed in a specific structure)
        const title = doc.querySelector('h1')?.textContent || 'No Title';
        const desc = doc.querySelector('meta[name="description"]')?.getAttribute('content') || 'No description available.';
        const img = doc.querySelector('img')?.src || '';

        return { url, title, description: desc, img };
      } catch (err) {
        console.error(`Failed to fetch project preview from ${url}:`, err);
        return null;
      }
    }

    // Load and display project previews
    async function loadProjects() {
      for (const url of projects) {
        const preview = await fetchProjectPreview(url);
        if (preview) {
          // Create the project preview element
          const article = document.createElement('article');
          article.className = 'project-entry';

          if (preview.img) {
            const imgEl = document.createElement('img');
            imgEl.src = preview.img;
            imgEl.alt = preview.title + ' preview';
            article.appendChild(imgEl);
          }

          const titleEl = document.createElement('h2');
          titleEl.textContent = preview.title;
          article.appendChild(titleEl);

          const descEl = document.createElement('p');
          descEl.textContent = preview.description;
          article.appendChild(descEl);

          const linkEl = document.createElement('a');
          linkEl.href = url;
          linkEl.className = 'read-more';
          linkEl.textContent = 'Read more';
          article.appendChild(linkEl);

          projectListEl.appendChild(article);
        }
      }
    }

    loadProjects();
  </script>
  
</body>
</html>
